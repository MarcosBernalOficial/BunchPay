<div class="min-h-screen bg-black text-white">
    <app-page-header title="Pagar servicio" [showBackButton]="true" backRoute="/services/catalog"></app-page-header>

    <main class="max-w-3xl mx-auto px-4 py-6">
        @if (loadingService()) {
        <div class="text-center py-12 text-white/70">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
            <p class="mt-4">Cargando información del servicio...</p>
        </div>
        }

        @if (error() && !service()) {
        <div class="p-4 bg-red-900/50 border border-red-700 rounded-md text-red-300 text-center">
            {{ error() }}
        </div>
        }

        @if (service()) {
        @if (success()) {
            <div class="mb-4 p-3 bg-green-900/50 border border-green-700 rounded-md text-green-300">
            {{ success() }}
            </div>
        }

        @if (error() && service()) {
            <div class="mb-4 p-3 bg-red-900/50 border border-red-700 rounded-md text-red-300">
            {{ error() }}
            </div>
        }

        <div class="border border-white/10 rounded-xl p-6 space-y-6">
            <div class="border-b border-white/10 pb-4">
            <h2 class="text-2xl font-semibold">{{ service()!.name }}</h2>
            @if (service()!.description) {
                <p class="text-sm text-white/70 mt-2">{{ service()!.description }}</p>
            }
            </div>

            <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-4">
            <div>
                <label class="block text-sm text-white/70 mb-1">Monto</label>
                <input 
                type="number" 
                formControlName="amount" 
                placeholder="0.00"
                min="1"
                step="0.01"
                class="w-full rounded-md bg-white/5 border border-white/10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-white/30"
                [class.border-red-500]="form.get('amount')?.invalid && form.get('amount')?.touched"
                />
                @if (service()!.minAmount || service()!.maxAmount) {
                <div class="text-xs text-white/50 mt-1">
                    @if (service()!.minAmount && service()!.maxAmount) {
                    <span>Monto permitido: ${{ service()!.minAmount }} - ${{ service()!.maxAmount }}</span>
                    } @else if (service()!.minAmount) {
                    <span>Monto mínimo: ${{ service()!.minAmount }}</span>
                    } @else if (service()!.maxAmount) {
                    <span>Monto máximo: ${{ service()!.maxAmount }}</span>
                    }
                </div>
                }
                @if (form.get('amount')?.invalid && form.get('amount')?.touched) {
                <div class="text-xs text-red-400 mt-1">
                    @if (form.get('amount')?.errors?.['required']) {
                    <span>El monto es requerido</span>
                    }
                    @if (form.get('amount')?.errors?.['min']) {
                    <span>El monto debe ser mayor a 0</span>
                    }
                </div>
                }
            </div>

            <div>
                <label class="block text-sm text-white/70 mb-1">Referencia (opcional)</label>
                <input 
                type="text" 
                formControlName="reference" 
                placeholder="Número de cliente, referencia, etc."
                class="w-full rounded-md bg-white/5 border border-white/10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-white/30"
                />
            </div>

            <button 
                type="submit" 
                [disabled]="form.invalid || loading()"
                class="w-full px-4 py-2 bg-white text-black rounded hover:bg-white/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                {{ loading() ? 'Procesando...' : 'Realizar pago' }}
            </button>
            </form>
        </div>
        }
    </main>
</div>
